<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Desempenho dos Operadores</title>
  <link rel="stylesheet" href="../css/desempenho.css">
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@100..800&display=swap" rel="stylesheet">
</head>

<body onload="carregar()">
  <header>
    <nav class="header">
      <div class="user_div">
        <div class="img"></div>
        <span class="user_name" id="nome_usuario"></span>
      </div>

      <ul>
        <a href="./servidores.html">Monitoramento</a>
      </ul>
      <ul>
        <a href="./insghts.html">Insights</a>
      </ul>
      <ul>
        <a href="./usuarios.html">Usuários</a>
      </ul>
      <ul>
        <a href="./suporte.html">Suporte</a>
      </ul>

      <button class="sair" onclick="limparSessao()">Sair</button>
    </nav>
  </header>
  <div class="mae">
    <div class="cima">
      <div class="card">
        <div class="card-header">
          <h2>Lista de Chamados em Abertos</h2>
          <div class="pesquisa">
            <input type="text" placeholder="Pesquisar">
          </div>

        </div>

        <table id="ranking-alertas">
          <thead>
            <tr>
              <th>Servidor</th>
              <th>Componentes</th>
              <th>Tempo (MINUTOS)</th>
              <th>Status</th>
              <th>Operador Responsável</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td></td>
              <td class="tempo"></td>
              <td class="status-critico"></td>
              <td></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td class="tempo"></td>
              <td class="status-moderado"></td>
              <td></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td class="tempo"></td>
              <td class="status-critico"></td>
              <td></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td class="tempo"></td>
              <td class="status-moderado"></td>
              <td></td>
            </tr>
          </tbody>
        </table>

      </div>
      <div class="kpis-container">
        
        <!-- Chamados Abertos -->
        <div class="kpis-coluna">
          <div class="titulo"><strong>Chamados Abertos</strong></div>
          <div class="vermelho-titulo">15</div>
          <div>Críticos</div>
          <div class="status-critico-titulo">57%</div>
          <div>Moderados</div>
          <div class="status-moderado">43%</div>
        </div>

        <!-- Chamados Resolvidos -->
        <div class="kpis-coluna">
          <div class="titulo"><strong>Chamados Resolvidos</strong></div>
          <div class="nmr-titulo">27</div>
          <div>Críticos</div>
          <div class="status-critico-titulo">32%</div>
          <div>Moderados</div>
          <div class="status-moderado">68%</div>
        </div>
      </div>



    </div>

    <div class="bottom-layout">
      <div class="grafico-container">
        <div class="grafico-header">
          <h3 class="grafico-titulo">Distribuição de Chamados por Componente</h3>

          <select class="date-filter">
            <option value="semana">Dia Atual</option>
            <option value="semana">Última semana</option>
            <option value="mes">Último mês</option>
            <option value="mes">Último 6 meses</option>
            <option value="mes">Último 1 ano</option>


          </select>

        </div>
        <div class="grafiquinho" id="containerGrafico">
          <canvas id="meuGrafico">
          </canvas>
        </div>
      </div>




      <!-- desempenho-->
      <div class="card-desempenho">
        <div class="filtros">
          <div class="titulo">Desempenho dos Operadores</div>
          <div class="pesquisa">
            <input type="text" placeholder="Pesquisar">
          </div>
          <div class="date-filter">
            <span class="calendar-icon"></span>
            <span>Dia Atual</span>
            <div class="arrow-icon"></div>
          </div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Operador</th>
              <th>Atribuídos</th>
              <th>Realizados</th>
              <th>Com Atraso</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Matheus Diniz</td>
              <td>17</td>
              <td class="red-text">12</td>
              <td class="red-text">6</td>
            </tr>
            <tr>
              <td>Hugo Carvalho</td>
              <td>15</td>
              <td class="red-text">10</td>
              <td class="red-text">5</td>


            </tr>
            <tr>
              <td>Grigor Mascarenhas</td>
              <td>7</td>
              <td>5</td>
              <td class="red-text">3</td>

            </tr>
            <tr>
              <td>Jonathan Calleri</td>
              <td>4</td>
              <td>4</td>
              <td>1</td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>
  </div>
  </div>
  </div>

</body>


</html>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

  window.onload = function () {
    const ctx = document.getElementById('meuGrafico').getContext('2d');
    const meuGrafico = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['HD', 'Disco', 'GPU', 'CPU', 'RAM'],
        datasets: [
          {
            label: 'Crítico',
            data: [15, 40, 95, 50, 30],
            backgroundColor: 'rgba(	205, 48, 48)',
            borderRadius: 6,
            barThickness: 25
          },
          {
            label: 'Moderado',
            data: [10, 35, 55, 53, 55],
            backgroundColor: 'rgba(255, 161, 0)',
            borderRadius: 6,
            barThickness: 25
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: {
          padding: {
            top: 10,
            bottom: 10,
            left: 0,
            right: 0
          }
        },
        plugins: {
          legend: {
            display: true,
            position: 'right',
            labels: {
              usePointStyle: true,
              padding: 20
            }
          },
          tooltip: {
            mode: 'index',
            intersect: false
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Componentes'
            },
            grid: {
              display: false
            }
          },
          y: {
            title: {
              display: true,
              text: 'Quantidade de Chamados'
            },
            beginAtZero: true,
            grid: {
              color: '#e0e0e0'
            }
          }
        }
      }
    });
  };


  nome_usuario.innerHTML = sessionStorage.NOME_USUARIO;
  let info;

async function receberChamado() {
  try {
    const resposta = await fetch("http://localhost:8000/desempenho/recebe/chamado");

    if (!resposta.ok) {
      console.error(`Erro na resposta: ${resposta.status}`);
      return;
    }

    const dados = await resposta.json();
    console.log("✅ Dados recebidos:", dados);

   
      const tbody = document.querySelector("#ranking-alertas tbody");
      
      console.log("coco xixi bunda");

    if (!tbody) {
      console.error("❌ Não foi possível encontrar o tbody da tabela!");
      return;
    }
        tbody.innerHTML = "";
      dados.forEach(entrada => {
      const classe = entrada.tipo_alertas ? entrada.tipo_alertas.toLowerCase() : "";
        const linha = `
        <tr>
          <td>${entrada.servidor}</td>
          <td>${entrada.componente}</td>
          <td>${entrada.data_hora}</td>
          <td>${entrada.tipo_alertas}</td>
          <td>${entrada.operador_responsavel}</td>
        </tr>  
        `;
        tbody.innerHTML += linha;
      });
    
  
    
  } catch (erro) {
    console.error("❌ Erro ao buscar os dados:", erro);
  }
}
  

  receberChamado()
</script>